<!DOCTYPE html>
<html>
<head>
	<title>WebGL Bilateral Transform</title>

	</head>
<body>
	<canvas id="canvas" width="800" height="600"></canvas>

	<script id="bilateral-vs" type="x-shader/x-vertex">
		precision mediump float;
		
		attribute vec2 a_position;
		
		varying vec2 v_texCoord;

		void main() {
			gl_Position = vec4((a_position * 2.0 - 1.0) * vec2(1.0,-1.0),0,1);
			v_texCoord = a_position;
		}
	</script>
	<script id="bilateral-fs" type="x-shader/x-fragment">
		precision mediump float;

		uniform vec2 u_resolution;
		uniform sampler2D u_image;
		uniform sampler2D u_gaussian;

		varying vec2 v_texCoord;

		const int c_winSize = 51;

		void main() {
			vec2 pixSize = 1.0 / u_resolution; // Distance between pixels in clipspace
			vec3 color = vec3(0.0,0.0,0.0);
			float u_ssig = 3.0;
			float sum = 0.0;
			// Loop through pixels contained in window for current fragment
			for (int x = -1 * c_winSize / 2; x <= c_winSize / 2; x++) {
				for (int y = -1 * c_winSize / 2; y <= c_winSize / 2; y++) {
					// Get the texture coordinate of current pixel
					vec2 texCoord = v_texCoord + vec2(x,y) * pixSize;
					// Get the coordinates for the gaussian lookup value
					vec2 luCoord = vec2(clamp(length(vec2(x,y)) / (u_ssig * 3.0),0.0,1.0),0.0);
					vec4 luVal = texture2D(u_gaussian,luCoord);
					// Add the contribution from this pixel
					sum += luVal.r;
					color += texture2D(u_image, texCoord).rgb * luVal.rgb;
				}
			}
			gl_FragColor = vec4(color / sum,1.0);
		}
  
	</script>
	<!-- bower:js -->
	<!-- endbower -->

	<script src="scripts/gaussian.js"></script>
	<script src="scripts/main.js"></script>


</body>
</html>
